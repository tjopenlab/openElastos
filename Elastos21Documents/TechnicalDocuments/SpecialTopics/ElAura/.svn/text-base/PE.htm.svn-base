<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="File-List" href="PE.files/filelist.xml">

<title>PE格式文件加载</title>
<style>
</style>
<!--[if !mso]>
<style>
v\:*         { behavior: url(#default#VML) }
o\:*         { behavior: url(#default#VML) }
.shape       { behavior: url(#default#VML) }
</style>
<![endif]--><!--[if gte mso 9]>
<xml><o:shapedefaults v:ext="edit" spidmax="1027"/>
</xml><![endif]-->
</head>

<body>

<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<font size="5"><span style="font-family: 宋体; font-weight: 700">PE格式文件加载</span></font></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span style="font-family: 宋体"><font size="4">对应用程序的加载和卸载是<span lang="EN-US">ElAura</span>的首要任务。操作系统本身的应用程序加载器只能识别自己支持的可执行文件格式。<span lang="EN-US">Elastos</span>和<span lang="EN-US">Windows</span>操作系统的可执行文件格式是<span lang="EN-US">PE</span>格式，而<span lang="EN-US">Linux</span>的可执行文件是<span lang="EN-US">ELF</span>格式</font></span><font size="4"><sup><span lang="EN-US" style="font-family: 宋体">[4]</span></sup></font><span style="font-family: 宋体"><font size="4">。因此对于像<span lang="EN-US">Linux</span>这种不支持<span lang="EN-US">PE</span>格式的操作系统，<span lang="EN-US">ElAura</span>必须提供<span lang="EN-US">PE</span>文件加载器。</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US" style="font-family: 宋体"><font size="4">PE</font></span><span style="font-family: 宋体"><font size="4">加载器本身是目标操作系统支持的一个应用程序，因此可以在目标操作系统上运行。<span lang="EN-US">PE</span>加载器会把目标操作系统不支持的可执行文件加载到自己的地址空间内，并跳转执行，从而达到加载的目的。图<span lang="EN-US">3</span>是<span lang="EN-US">PE
</span>加载器工作原理图。</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span style="font-family: 宋体"><font size="4">在加载开始前，在目标操作系统上运行<span lang="EN-US">PE</span>加载器，因为<span lang="EN-US">PE</span>加载器本身是目标操作系统所支持的可执行文件格式，因此目标操作系统会创建一个新的进程，然后把<span lang="EN-US">PE</span>加载器本身加载到新的进程地址空间内。<span lang="EN-US">PE</span>加载器会从外存和文件系统上读取要加载的<span lang="EN-US">PE</span>可执行文件，并解析文件格式。然后，<span lang="EN-US">PE</span>加载器会在自己的地址空间内开辟一段新的内存，把可执行文件的代码段、数据段加载到内存中。如果代码需要重定位操作，<span lang="EN-US">PE</span>加载器还帮助代码段进行重定位，如果可执行文件有依赖关系，<span lang="EN-US">PE</span>加载器会把它所依赖的部分也一起加载起来。经过这些步骤之后，可执行文件就已经在进程的地址空间中以可运行的状态存在。最后，<span lang="EN-US">PE</span>加载器会跳转到新加载到内存中的代码段开始执行。</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span style="font-family: 宋体"><font size="4">通过<span lang="EN-US">PE</span>加载器，可以解决目标操作系统本身的加载器不能加载和欣应用的可执行文件的问题，让和欣程序在目标操作系统上运行成为可能。应用程序运行结束卸载的时候，依然是目标操作系统自动回收该进程占据的所有资源，无须进行更多的干预。</font></span></p>
<p class="MsoBodyText" style="text-indent: 20.0pt; line-height: 200%"><!--[if gte vml 1]><v:group id="_x0000_s1025"
 style='position:absolute;margin-left:183pt;margin-top:-13.5pt;width:312pt;
 height:198pt;z-index:1' coordorigin="6133,11230" coordsize="3767,2808">
 <v:rect id="_x0000_s1026" style='position:absolute;left:6300;top:11230;
  width:1362;height:2808'>
  <v:stroke dashstyle="dash"/>
 </v:rect><v:rect id="_x0000_s1027" style='position:absolute;left:8662;top:11230;
  width:1238;height:2808'>
  <v:stroke dashstyle="dash"/>
 </v:rect><v:rect id="_x0000_s1028" style='position:absolute;left:6300;top:11752;
  width:1362;height:407'>
  <v:textbox style='mso-next-textbox:#_x0000_s1028'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table10">
	<tr>
		<td><![endif]>
		<div>
			<p class="a" style="tab-stops: 0cm; margin-left: 0cm; margin-right: 0cm; margin-top: 0cm; margin-bottom: .0001pt">
			<span lang="EN-US" style="mso-bidi-font-size: 12.0pt; font-family: Times New Roman">
			<o:p><font size="4">&nbsp;</font></o:p></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1029" style='position:absolute;left:6300;top:12159;
  width:1362;height:407'>
  <v:textbox style='mso-next-textbox:#_x0000_s1029'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table9">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">数据段</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1030" style='position:absolute;left:6300;top:12566;
  width:1362;height:407'>
  <v:textbox style='mso-next-textbox:#_x0000_s1030'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table8">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">代码段</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1031" style='position:absolute;left:6300;top:13516;
  width:1362;height:407'>
  <v:textbox style='mso-next-textbox:#_x0000_s1031'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table7">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span lang="EN-GB" style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">PE</font></span><span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB"><font size="4">加载器</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1032" style='position:absolute;left:8662;top:12431;
  width:1238;height:406'>
  <v:textbox style='mso-next-textbox:#_x0000_s1032'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table6">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span lang="EN-GB" style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">PE</font></span><span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB"><font size="4">可执行文件</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1033" style='position:absolute;left:6133;top:11291;
  width:1607;height:407' filled="f" stroked="f">
  <v:textbox style='mso-next-textbox:#_x0000_s1033'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table5">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">进程地址空间</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:line id="_x0000_s1034" style='position:absolute;flip:x' from="7662,12702"
  to="8662,12702">
  <v:stroke endarrow="block"/>
 </v:line><v:line id="_x0000_s1035" style='position:absolute;flip:y' from="7020,12973"
  to="7020,13516">
  <v:stroke endarrow="block"/>
 </v:line><v:rect id="_x0000_s1036" style='position:absolute;left:7591;top:13380;
  width:1250;height:407' filled="f" stroked="f">
  <v:textbox style='mso-next-textbox:#_x0000_s1036'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table4">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; text-indent: 10.25pt; mso-char-indent-count: 1.71; tab-stops: 0cm">
			<span lang="EN-GB" style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">1</font></span><span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB"><font size="4">读取</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1037" style='position:absolute;left:7591;top:12295;
  width:1250;height:407' filled="f" stroked="f">
  <v:textbox style='mso-next-textbox:#_x0000_s1037'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table3">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; text-indent: 10.25pt; mso-char-indent-count: 1.71; tab-stops: 0cm">
			<span lang="EN-GB" style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">2</font></span><span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB"><font size="4">加载</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:rect id="_x0000_s1038" style='position:absolute;left:6300;top:13109;
  width:857;height:407' filled="f" stroked="f">
  <v:textbox style='mso-next-textbox:#_x0000_s1038'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table2">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; text-indent: 10.25pt; mso-char-indent-count: 1.71; tab-stops: 0cm">
			<span lang="EN-GB" style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">3</font></span><span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB"><font size="4">跳转</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect><v:line id="_x0000_s1039" style='position:absolute' from="7662,13787"
  to="9376,13787"/>
 <v:line id="_x0000_s1040" style='position:absolute;flip:y' from="9376,12837"
  to="9376,13787">
  <v:stroke endarrow="block"/>
 </v:line><v:rect id="_x0000_s1041" style='position:absolute;left:8721;top:11296;
  width:1179;height:402' filled="f" stroked="f">
  <v:textbox style='mso-next-textbox:#_x0000_s1041'>
<![if !mso]>
<table cellpadding="0" cellspacing="0" width="100%" id="table1">
	<tr>
		<td><![endif]>
		<div>
			<p class="MsoNormal" align="center" style="text-align: center; tab-stops: 0cm">
			<span style="mso-bidi-font-size: 12.0pt; font-family: 宋体; mso-ansi-language: EN-GB">
			<font size="4">外存</font></span></div>
		<![if !mso]></td>
	</tr>
</table>
<![endif]></v:textbox>
 </v:rect></v:group><![endif]--><![if !vml]><span style='mso-ignore:vglayout;
position:absolute;z-index:1;left:281px;top:563px;width:421px;height:266px'><img
width=421 height=266 src="PE.files/image001.gif" v:shapes="_x0000_s1025 _x0000_s1026 _x0000_s1027 _x0000_s1028 _x0000_s1029 _x0000_s1030 _x0000_s1031 _x0000_s1032 _x0000_s1033 _x0000_s1034 _x0000_s1035 _x0000_s1036 _x0000_s1037 _x0000_s1038 _x0000_s1039 _x0000_s1040 _x0000_s1041"></span><![endif]></font><span lang="EN-US"><font size="4">&nbsp;</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US"><font size="4">&nbsp;</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US"><font size="4">&nbsp;</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US"><font size="4">&nbsp;</font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US"><font size="4">&nbsp;&nbsp;&nbsp; </font></span></p>
<p class="MsoBodyText" style="text-indent: 18.0pt; line-height: 200%">
<span lang="EN-US"><font size="4">&nbsp;</font></span></p><p class="MsoBodyText" align="center" style="text-align: center; text-indent: 0cm; line-height: 200%">
<span style="font-family: 宋体"><font size="4">图<span lang="EN-US">3 &nbsp;PE</span>加载器原理图</font></span></p>
<p class="MsoBodyText" align="center" style="text-align: center; text-indent: 0cm; line-height: 200%">
<font size="4"><span style="font-family: 宋体">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<a href="index.htm">返回首页</a></li>
</p>

</body>

</html>
