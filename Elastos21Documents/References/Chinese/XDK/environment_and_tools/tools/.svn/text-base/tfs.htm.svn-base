<!--==========================================================================-->
<!-- Copyright (c) 2000-2004,  Elastos, Inc.  All Rights Reserved.-->
<!--==========================================================================-->

<html>
<head>
<title>TFTP文件系统使用简介</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<script src="/xsl/docstyles.js"></script>
</head>

<body>

<h2>TFTP文件系统使用简介</h2>
    <p>本文将主要介绍以下内容：</p>
    <ul>
        <li><a class="style1" href="#tftp">TFTP文件系统与“Elastos”操作系统</a>
        <li><a class="style1" href="#summarize">TFTP文件系统简介</a>
        <li><a class="style1" href="#config">TFTP文件系统的配置</a>
    </ul>

    <A NAME="tftp"></A>
    <h3>TFTP文件系统与“Elastos”操作系统</h3>
        <p>“Elastos”操作系统支持TFTP文件系统（简称TFS）。如下图所示，“Elastos”文件系统提供了基本的文件系统接口给“Elastos”操作系统，“Elastos”操作系统向其文件系统提供系统服务。“Elastos”文件系统有一个虚拟文件系统框架vfs，vfs下挂有其它的文件系统，如tftpfs，msdos等。</p>
        <center><img src="images/tfs.jpg"></center>
        <center>图一：TFTP文件系统与“Elastos”操作系统</center>

    <A NAME="summarize"></A>
    <h3>TFTP文件系统简介</h3>
        <p>TFS用于在运行“Elastos”操作系统的机器上（客户机）访问位于其他主机（服务器）中的文件和目录。它们之间通过TFTP文件传输协议进行通讯。为使用TFS，服务器端需要运行TFTP服务程序。假设ElastosXDK的安装目录为C:\Elastos，TFTP服务程序会将C:\Elastos\XDK\Targets\sdk\zener\x86.gnu.pc.dbg(如果是在GNU zener x86版下)作为TFTP输出根目录。</p>
        <p>TFS运行后，在客户端的操作就是对服务器端TFTP输出根目录的操作。如对其中一个目录进行操作，均可在服务器端TFTP输出根目录看到相应的变化。客户端可以对服务器端TFTP输出根目录下的文件进行创建、读取、运行或修改操作。<font color="red">但是不能删除文件和更改文件名，也不能增加或删除子目录。</font></p>
        <p>用户可以在服务器上对TFTP输出根目录直接进行修改，比如增加目录、删除文件等，但每次修改后需要运行<a class="style1" href="../../../resource_debug_kits/tools/mktfs.htm">mktfs</a>以保证TFS的内容与服务器端一致。TFS根据服务器端输出目录的_tfsindex文件（_tfsindex文件的内容是其所在目录的文件列表）浏览输出目录的内容。如果用户直接在服务器端输出目录下添加文件或目录而不更新_tfsindex文件，就无法在客户端对这些新添加的文件或目录进行操作。“Elastos”系统提供的工具mktfs用于生成或更新上述_tfsindex文件，还会生成_tfsdirindex文件（用于文件记录_tfsindex文件的属性）。ElastosXDK安装程序和编译命令会自动调用mktfs，因此若运行这两个程序后没有改变输出根目录的内容，就无需再次运行mktfs。</p>
        <p>客户与服务器之间通过网络进行通讯，因此TFS的读写速度与网络状况相关，而且当网络断连时，对TFS的操作会因网络超时而失败。</p>
        <p>从网络启动的“Elastos”默认将TFS安装为根文件系统。安装ElastosXDK后，从网络启动“Elastos”操作系统，此时对根文件系统的操作就是对客户机的%XDK_TARGETS%目录的操作。</p>
        <p>为使TFS正常运行，首先应确保客户机TCP/IP网络的正确配置，并且使用<a class="style1" href="network/ping.htm">ping</a>等命令检查客户机与服务器之间的网络连接。</p>

    <A NAME="config"></A>
    <h3>TFTP文件系统配置</h3>
        <p>TFTP文件系统配置步骤如下：</p>
        <p><b>1.修改tfs.cfg文件。</b></p>
        <p>将客户机和服务器的IP地址写入%XDK_COMMON_CONFIG%下的tfs.cfg文件中。例如：</p>
        <pre class="code">
SERVER_IP:192.168.1.31
CLIENT_IP:192.168.2.31
</pre>
        <p><b>2.修改mkpkg.cfg文件。</b></p>
        <p>mkpkg.cfg文件存放于%XDK_COMMON_CONFIG%目录中，具体内容如下所示。要想使用tfs文件系统就必须包含红色标注的项。</p>
        <pre class="code">

TARGET = %XDK_TARGETS%\elastos.img

BIAS = 0x00000000

ALIGN = 0x1000

FILES = \
    <font color="blue">%XDK_RUNTIME_PLATFORM%\kernel.exe \
    %XDK_RUNTIME_PLATFORM%\elastos.dll \</font>
    %XDK_TARGETS%\ElMathLib.dll \
    %XDK_TARGETS%\ElCRuntime.dll \
    <font color="blue">%XDK_COMMON_CONFIG%\drv.cfg \</font>
    <font color="red">%XDK_COMMON_CONFIG%\tfs.cfg \</font>
    <font color="blue">%XDK_TARGETS%\tcpip.dll \</font>
    %XDK_TARGETS%\ezregsvr.exe \
    %XDK_TARGETS%\waitsvr.exe \
    %XDK_TARGETS%\bmfs.dll \
    %XDK_TARGETS%\crtsvr.dll \
    %XDK_TARGETS%\elacmd.exe \
    %XDK_TARGETS%\memfs.dll \
    %XDK_TARGETS%\ElDevices.dll \
    %XDK_TARGETS%\SuperExe.exe \
    %XDK_TARGETS%\xsf.exe \
    %XDK_TARGETS%\udc.exe \
    %XDK_TARGETS%\clipboard.dll \
    %XDK_COMMON_DATA%\i18n\encoding.dat \
    %XDK_COMMON_CONFIG%\autorun.bat \
    <font color="red">%XDK_COMMON_CONFIG%\services.cfg \</font>
    %XDK_COMMON_CONFIG%\elastos.cfg \
    %XDK_COMMON_CONFIG%\startup.cfg \

COMMANDLINE =

</pre>
        <p>以上用蓝色标注的项是网络部分的内容，这是使用tfs所必需的前提条件。要想运行tfs文件系统还必需包含红色标注的内容。其中vfs.dll包含tfs文件系统；mount.exe用来安装tfs文件系统；ezregsvr.exe和services.cfg分别用来注册文件系统和网络服务。</p>
        <p><b>3.修改startup.cfg文件。</b></p>
        <p>startup.cfg文件也存放于%XDK_COMMON_CONFIG%目录中，如下所示。红色标注的项为tfs所必需的内容。</p>
        <pre class="code">
<font color="red">ezregsvr.exe services.cfg &</font>
<font color="red">ifconfig.exe lo0 127.0.0.1 netmask 255.255.248.0</font>
<font color="red">ifconfig.exe eth0 192.168.2.31 netmask 255.255.248.0 broadcast 192.168.7.255</font>
route.exe add default 192.168.0.1
<font color="red">mount.exe -t tftpfs -d / -s TFTP</font>
elacmd.exe
reboot 1

</pre>
        <p>其中<a class="style1" href="shell/Ezregsvr.htm">ezregsvr.exe</a>作为后台程序第一个运行，<a class="style1" href="shell/Mount.htm">mount.exe</a>是文件系统安装程序。</p>
        <p><b>4.运行mkpkg命令，在客户端（单板机）启动“Elastos”。</b></p>
        <p>启动后的界面如下：</p>
        <pre class="code">
[/ $]


</pre>
        <p>用户可在[/ $]后输入有关文件系统的命令，如<a class="style1" href="shell/Dir.htm">dir</a>，<a class="style1" href="shell/Type.htm">type</a>等， 详细情况参见<a class="style1" href="shell.htm">shell命令相关文档</a>。</p>

<script>footer("chinese")</script>
</body>
</html>