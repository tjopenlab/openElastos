<!--==========================================================================-->
<!-- Copyright (c) 2000-2007,  Elastos, Inc.  All Rights Reserved.-->
<!--==========================================================================-->

<html>
<head>
<title>Í¼ÐÎ¿Ø¼þForm</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<script src="/xsl/docstyles.js"></script>
</head>

<body>

<h2> IForm::SetTimer\IForm::KillTimer·¶Àý³ÌÐò </h2>

<pre>
//==========================================================================
// Copyright (c) 2000-2007,  Elastos, Inc.  All Rights Reserved.
//==========================================================================

<h3> CDrawing0.h </h3>
#include &quot;_CDrawing0.h&quot;
class CDrawing0 : public _CDrawing0
{
public:
    CDrawing0();
    ~CDrawing0();

    CARAPI AtEntry(
        /* [in] */ EzArray<WString> argcv);

    CARAPI AtExit();

    CARAPI OnTimer(
        /* [in] */ IForm* pIObject,
        /* [in] */ UInt32   id);

    CARAPI OnClose(
        /* [in] */ IButton* pIObject);

private:
    IForm        * m_pMainForm;
    IButton      * m_pIBtnClose;
    IGraphics    * m_pIGraphics;
    Boolean           m_bFlag;
};

<h3> CDrawing0.cpp </h3>
#include &quot;CDrawing0.h&quot;
#include &quot;_CDrawing0.cpp&quot;
#include &lt;stdio.h&gt;

CDrawing0::CDrawing0()
{
    m_pMainForm     = NULL;
    m_pIBtnClose    = NULL;
    m_pIGraphics    = NULL;
    m_bFlag         = FALSE;
}

CDrawing0::~CDrawing0()
{
    if (m_pIBtnClose) {
        m_pIBtnClose->Release();
        m_pIBtnClose = NULL;
    }

    if (m_pMainForm) {
        m_pMainForm->Release();
        m_pMainForm = NULL;
    }

    if (m_pIGraphics) {
        m_pIGraphics->Release();
        m_pIGraphics = NULL;
    }
}

ECode CDrawing0::AtEntry(
        /* [in] */ EzArray<WString> argcv)
{
    ECode ec;

    ec = CForm::New(&m_pMainForm);
    if (FAILED(ec)) {
        return ec;
    }

    ec = m_pMainForm->Init(0, L"MAIN", 0, 0, 200, 280,  NULL);
    if (FAILED(ec)) {
        return ec;
    }

    ec = m_pMainForm->CreateGraphics(&m_pIGraphics);
    if (FAILED(ec)) {
        return ec;
    }

    ec = m_pMainForm->SetTimer(0, 500);
   if (FAILED(ec)) {
        return ec;
    }

    ec = CButton::New(&m_pIBtnClose);
    if (FAILED(ec)) {
        return ec;
    }

    ec = m_pIBtnClose->Init(0, L"Exit", 0, 250, 80, 30,  m_pMainForm);
    if (FAILED(ec)) {
        return ec;
    }

    CButton::AddClickCallback(m_pIBtnClose,
                 this, &CDrawing0::OnClose);

    CForm::AddTimerCallback(m_pMainForm,
                 this, &CDrawing0::OnTimer);

    m_pMainForm->Show();

    return NOERROR;
}

ECode CDrawing0::AtExit()
{
    return NOERROR;
}

ECode CDrawing0::OnClose(
        /* [in] */ IButton* pIObject)
{
    m_pMainForm->Close();
    return NOERROR;
}

ECode CDrawing0::OnTimer(
        /* [in] */ IForm *pIObject,
        /* [in] */ UInt32   id)
{
    ECode ec;
    static Int32 i = 0;

    if (m_bFlag) {
        ec = m_pIGraphics->DrawRectangle(0xff0000, 0, 0, 100, 120);
        if (FAILED(ec)) {
            return ec;
        }

        ec = m_pIGraphics->Update();
        if (FAILED(ec)) {
            return ec;
        }

        m_bFlag = FALSE;
        i++;
    }
    else {
        ec = m_pIGraphics->DrawRectangle(0xff00, 0, 0, 100, 120);
        if (FAILED(ec)) {
            return ec;
        }

        ec = m_pIGraphics->Update();
        if (FAILED(ec)) {
            return ec;
        }

        m_bFlag = TRUE;
        i++;
    }
    if (i == 10) {
        ec = m_pMainForm->KillTimer(0);
        if (FAILED(ec)) {
            return ec;
        }
    }
    return NOERROR;
}

</pre>

<script>footer("KoreTide")</script>
</body>
</html>