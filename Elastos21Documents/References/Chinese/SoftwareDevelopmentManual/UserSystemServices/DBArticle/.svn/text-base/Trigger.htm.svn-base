<!--==========================================================================-->
<!-- Copyright (c) 2000-2008,  Elastos, Inc.  All Rights Reserved.-->
<!--==========================================================================-->

<html>
<head>
<title>数据库触发器机制(Trigger)</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<script src="/xsl/docstyles.js"></script>
</head>

<body>
<h3>什么是触发器(Trigger)</h3>
    <p>触发器(Trigger)主要用于在表发生插入(INSERT)、更新(UPDATE) 及删除(DELETE)等触发事件时启动一段用户定义的程序。这段程序被称为触发程序，它可以由简单或复杂的SQL语句组成，触发程序将在用户指定的表发生指定的事件时被执行。比如输入两个字段的内容，用触发器的触发程序可以将两字段相乘，并将结果放入第三个字段。用户可以指定触发时机,即在触发事件发生之前(BEFORE)或之后(AFTER)执行触发程序，也可以指定用触发程序替代(INSTEAD OF)插入、更新和删除操作，但此时只能将触发器应用于视图。</p>
<h3>创建触发器 </h3>
    <p>在程序中使用触发器，首先要创建触发程序，即在程序中使用CREATE TRIGGER语句，格式如下：</p>
    <p><b>CREATE [TEMP|TEMPORARY] TRIGGER [IF NOT EXISTS] </b>&lt;触发器名&gt;<b> [BEFORE|AFTER] </b>&lt;触发事件&gt; <b>ON</b> [&lt;数据库名&gt;.] &lt;表名&gt; &lt;触发程序&gt;</p>
    <p><b>&lt;触发器名&gt;</b>:是要建立的触发器的名字。</p>
    <p><b>&lt;触发事件&gt;</b>:指对表进行的操作，包括删除(DELETE)、插入(INSERT)、更新(UPDATE)以及对指定列的更新(UPDATE OF column-list)，当对所指定的表进行了以上操作时将启动触发程序的执行。上述CREATE TRIGGER语句的&lt;触发事件&gt;部分的格式可以表示为：</p>
    <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>DELETE|INSERT|UPDATE|UPDATE OF column-list</b></p>
    <p><b>&lt;触发程序&gt;</b>:是当触发程序激活时所要执行的SQL语句，包括更新、插入、删除和查询语句。可使用BEGIN…END复合结构来包含多条语句。默认对表中的每一行(FOR EACH ROW)操作都会执行触发程序，也可以指定对满足条件的行(WHEN)进行操作时才执行触发程序。上述CREATE TRIGGER语句的&lt;触发程序&gt;部分的格式可以表示为:</p>
	<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>[FOR EACH ROW] [WHEN expression] BEGIN...END</b></p>
	<p>在触发程序中可以使用”NEW.列名”和”OLD.列名”来表示被修改的记录中的某个字段，例如，用户刚刚向表中插入(INSERT)了一条记录，那么“NEW.列名”则表示刚刚被插入的这条记录相应列的内容；又如，用户刚刚从表中删除(DELETE)了一条记录，那么“OLD.列名”则表示刚刚被删除的这条记录相应列的内容。NEW和OLD只能用于在触发器中表示触发事件所影响的记录内容。</p>
	<p><b>BEFORE|AFTER</b>:指定了触发时机，即可以在触发事件发生之前(BEFORE)或之后(AFTER)执行触发程序。</p>
	<p>如果表被删除，则在这个表上所建立的触发器也将被删除。</p>
	<p>如果想用触发程序替代触发事件在视图上所进行的操作，可以使用下面的CREATE TRIGGER语句：</p>
	<p><b>CREATE [TEMP|TEMPORARY] TRIGGER [IF NOT EXISTS] </b>&lt;触发器名&gt;<b> [INSTEAD OF] </b>&lt;触发事件&gt; <b>ON</b> [&lt;数据库名&gt;.] &lt;视图名&gt; &lt;触发程序&gt;</p>
	<p>该语句中INSTEAD OF指定了将以触发程序替代触发事件对视图所做的操作，包括删除(DELETE)、插入(INSERT)、更新(UPDATE)以及对指定列的更新(UPDATE OF column-list)。语句中其他部分的含义和对表建立的CREATE TRIGGER语句中相应部分的含义相同。</p>
	<p>使用触发程序的好处在于数据库会自动执行触发程序所定义的命令，触发程序在表中的记录经过修改 (例如手动输入或应用程序动作) 后，会立即激活，这使得数据库功能性更为强大。</p>
	<p>触发器还可以和<a href=UDF.htm>UDF</a>(用户定义函数)一起使用，这样可以在UDF中实现一些和程序主逻辑无关的事务，而用触发器在相应的时机自动激活并执行触发程序，应用只要关心自己核心的逻辑，一些无关的行为可以通过Trigger + UDF的方式来实现，比如同步、日志等等。</p>
<script>footer("chinese")</script>
</body>
</html>

